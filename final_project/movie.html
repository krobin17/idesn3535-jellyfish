<!DOCTYPE html>
<html>
<head>
	<title>Flicks To See</title>
	<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="  crossorigin="anonymous"></script>
	<script src="utils.js"></script>
	<link rel="stylesheet" type="text/css" href="normalize.css">
	<link rel="stylesheet" type="text/css" href="styles.css">
	<script src="./ratingapi.js"></script>
	<script src="template.js.html"></script>
	<script>
		$(document).ready(function(){
				$("body").prepend(getTemplate(headerTemplate, {class: "home", title: "Home"}))
				$("body").append(getTemplate(footerTemplate, {title: "Home"}))
			let previousScrollTop = 0;
				$(document).on('scroll', function(e){
					let currentScrollTop = $(document).scrollTop();
						if (currentScrollTop > previousScrollTop){
							$('header').addClass('hidden');
						} else {
							$('header').removeClass('hidden');
						}
						previousScrollTop = currentScrollTop;
				});
			var url = "http://www.bvandorn.com/idesn-3535/apis/jellyfish.json";
			$.ajax({
  				url: url,
  				success: function(response){
    				//console.log(response);
  					const movies = response.movies;
					let currentMovie;
					const title = getParameterByName('title');
					movies.forEach(function(movie){
   						if (movie.title === title){
     					currentMovie = movie;}
   						console.log(movie);
   						$("#movie-info").text(movie.title);
   						$("#movie-info").append(movie.summary);
   						$("#movie-info").append(movie.genre);
   						$("#movie-info").append(movie.rated);
   						$("#movie-info").append(movie.runtime);
   						$("#movie-info").append(movie.release_date);
   						$("#movie-info").append(movie.director);
   						$("#movie-info").append(movie.cast);
   					});
   					movies.forEach(function(movie){
   						if (movie.title === title){
     					currentMovie = movie;}
   						console.log(movie);
   						$("#movie-media").append(movie.media[1])
   						//<iframe width="560" height="315" src="movies.media[0].url" frameborder="0" gesture="media" allow="encrypted-media" allowfullscreen></iframe>
   						$("#movie-media").append(movie.media[0])
					});					
				}
			});
			function renderRatings(){
				$("#ratings").html("");
				const ratings = getRatings().ratings;
				let totalStars = 0;
				let totalRatings = 0;
				//console.log(ratings);
				ratings.forEach(function(r){
					if (r){
						const row = document.createElement("div");row.innerText = `Stars: ${r.stars} ${r.comment}`;
							$("#ratings").append(row);
							totalRatings++;
							totalStars += r.stars;
						}
				});
				const averageRating = totalStars / totalRatings;
				$("#average").text("Average Stars: "+averageRating.toFixed(2));
				$("#all-stars").css("width", averageRating/5*100 + "%");
			}
				setTimeout(renderRatings);
				$("#submit-button").on("click", function(){
					const starAmount = parseInt($("#my-dropdown").val());
					const comment = $("#my-comment").val();
					//console.log(starAmount);
					//console.log(comment);
					addRating({stars: starAmount, comment: comment});
					renderRatings();
					$("#my-comment").val("");
					$("#my-dropdown").val("1");
				});
	});
	</script>

</head>
<body>
	<div id="movie-content">
		<div id="movie-media"></div>
		<div id="movie-info">
			<div id="average"></div>
			<div id="average-stars">
				<div id="no-stars"><img src="images/nostars.svg"></div>
				<div id="all-stars"><img src="images/allstars.svg"></div>
			</div>
			<div id="ratings"></div>
			<select id="my-dropdown">
				<option value="1">1</option>
				<option value="2">2</option>
				<option value="3">3</option>
				<option value="4">4</option>
				<option value="5">5</option>
			</select>
			<input id="my-comment"/>
			<button id="submit-button">Submit</button>
		</div>
	</div>

</body>
</html>